<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>카카오페이 테스트 결제</title>
</head>
<body>
    <h1>카카오페이 테스트 결제</h1>
    
    <!-- Single Payment Section -->
    <h2>단건 결제</h2>
    <label for="singlePlanSelect">단건 결제 플랜 선택:</label>
    <select id="singlePlanSelect">
        <option value="1">플랜 1 - 50 토큰, 5000원</option>
        <option value="2">플랜 2 - 100 토큰, 10000원</option>
        <option value="3">플랜 3 - 200 토큰, 20000원</option>
    </select>
    <br><br>
    <button id="singlePayButton">단건 결제하기</button>
    
    <!-- Subscription Payment Section -->
    <h2>정기 결제</h2>
    <label for="subscriptionPlanSelect">구독 플랜 선택:</label>
    <select id="subscriptionPlanSelect">
        <option value="1">플랜 1 - 정기 구독 플랜, 15000</option>
    </select>
    <br><br>
    <button id="subscriptionPayButton">정기 결제하기</button>

    <!-- Pay Subscription Button -->
    <h2>정기 결제 실행</h2>
    <button id="paySubscriptionButton">정기 결제 실행</button>

    <script>
        document.getElementById("singlePayButton").onclick = async function() {
            const planId = document.getElementById("singlePlanSelect").value;
            try {
                // 단건 결제 준비 API 호출
                const response = await fetch('http://localhost:8000/v1/pay', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        "partner_user_id": "91eb38da-b130-408c-a6de-20e0c6733b9d",
                        "quantity": 1,
                        "plan_id": planId
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    if (data.redirect_url) {
                        window.location.href = data.redirect_url;
                    } else {
                        alert('리디렉션 URL이 없습니다.');
                    }
                } else {
                    const errorData = await response.json();
                    alert('단건 결제 준비에 실패했습니다: ' + errorData.detail);
                }
            } catch (error) {
                console.error('단건 결제 요청 중 오류 발생:', error);
                alert('단건 결제 요청 중 오류가 발생했습니다.');
            }
        };

        document.getElementById("subscriptionPayButton").onclick = async function() {
            const planId = document.getElementById("subscriptionPlanSelect").value;
            try {
                // 정기 결제 준비 API 호출
                const response = await fetch('http://localhost:8000/v1/subscription', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        "partner_user_id": "91eb38da-b130-408c-a6de-20e0c6733b9d",
                        "quantity": 1,
                        "plan_id": planId
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    if (data.redirect_url) {
                        window.location.href = data.redirect_url;
                    } else {
                        alert('리디렉션 URL이 없습니다.');
                    }
                } else {
                    const errorData = await response.json();
                    alert('정기 결제 준비에 실패했습니다: ' + errorData.detail);
                }
            } catch (error) {
                console.error('정기 결제 요청 중 오류 발생:', error);
                alert('정기 결제 요청 중 오류가 발생했습니다.');
            }
        };

        document.getElementById("paySubscriptionButton").onclick = async function() {
            try {
                // 정기 결제 실행 API 호출
                const response = await fetch('http://localhost:8000/v1/subscription/pay', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    alert('정기 결제 실행 성공: ' + JSON.stringify(data));
                } else {
                    const errorData = await response.json();
                    alert('정기 결제 실행에 실패했습니다: ' + errorData.detail);
                }
            } catch (error) {
                console.error('정기 결제 실행 중 오류 발생:', error);
                alert('정기 결제 실행 중 오류가 발생했습니다.');
            }
        };
    </script>
    
</body>
</html>
